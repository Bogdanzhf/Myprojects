-- Создание базы данных Books (если еще не создана) 
CREATE DATABASE IF NOT EXISTS Books; 

-- Создание таблицы Направление 
CREATE TABLE IF NOT EXISTS direction ( 
 id_direction SERIAL PRIMARY KEY, 
 name VARCHAR(50) NOT NULL 
); 
 
-- Создание таблицы Автор 
CREATE TABLE IF NOT EXISTS author ( 
 id_author SERIAL PRIMARY KEY, 
 name VARCHAR(100) NOT NULL 
); 
 
-- Создание таблицы Название книги 
CREATE TABLE IF NOT EXISTS book_title ( 
 id_book_title SERIAL PRIMARY KEY, 
 title VARCHAR(100) NOT NULL, 
 fk_author INT NOT NULL, 
 FOREIGN KEY (fk_author) REFERENCES author(id_author) ON DELETE CASCADE 
); 
 
-- Создание таблицы Читатель 
CREATE TABLE IF NOT EXISTS reader ( 
 id_reader SERIAL PRIMARY KEY, 
 full_name VARCHAR(100) NOT NULL, 
 fk_direction INT NOT NULL, 
 FOREIGN KEY (fk_direction) REFERENCES direction(id_direction) ON DELETE CASCADE 
); 
 
-- Создание таблицы Выдача книги 
CREATE TABLE IF NOT EXISTS book_issue ( 
 fk_reader INT NOT NULL, 
 number INT NOT NULL, 
 fid_book INT NOT NULL, 
 issue_date DATE NOT NULL, 
 return_date DATE, 
 PRIMARY KEY (fk_reader, number), 
 FOREIGN KEY (fk_reader) REFERENCES reader(id_reader) ON DELETE CASCADE, 
 FOREIGN KEY (fid_book) REFERENCES book_title(id_book_title) ON DELETE CASCADE 
); 
 
-- Вставка данных в таблицу Направление 
INSERT INTO direction (name) VALUES 
('Химия'), 
('Физика'), 
('Математика'), 
('Биология'), 
('Информатика'), 
('История'), 
('География'), 
('Литература'); 
 
-- Вставка данных в таблицу Автор 
INSERT INTO author (name) VALUES 
('Солженицын'), 
('Толстой'), 
('Достоевский'), 
('Булгаков'), 
('Пушкин'), 
('Лермонтов'), 
('Гоголь'), 
('Чехов'), 
('Акунин'), 
('Пелевин'), 
('Иванов'), 
('Петров'), 
('Сидоров'); 
 
-- Вставка данных в таблицу Название книги 
INSERT INTO book_title (title, fk_author) VALUES 
('Один день Ивана Денисовича', 1), -- Солженицын 
('Война и Мир', 2), -- Толстой 
('Преступление и наказание', 3), -- Достоевский 
('Мастер и Маргарита', 4), -- Булгаков 
('Евгений Онегин', 5), -- Пушкин 
('Герой нашего времени', 6), -- Лермонтов 
('Мертвые души', 7), -- Гоголь 
('Вишневый сад', 8), -- Чехов 
('Азазель', 9), -- Акунин 
('Чапаев и Пустота', 10), -- Пелевин 
('Сердце Пармы', 11), -- Иванов 
('Петровы в гриппе и вокруг него', 12), -- Петров 
('Текст', 13), -- Сидоров 
('Собачье сердце', 4), -- Булгаков 
('Белая гвардия', 4), -- Булгаков 
('Двенадцать стульев', 11), --Ильф и Петров 
('Золотой теленок', 11), --Ильф и Петров 
('Идиот', 3), --Достоевский 
('Братья Карамазовы', 3); --Достоевский 
 
-- Вставка данных в таблицу Читатель 
INSERT INTO reader (full_name, fk_direction) VALUES 
('Кузнецова Анна Александровна', 1), -- Химия 
('Иванов Иван Иванович', 1), -- Химия 
('Петров Петр Петрович', 2), -- Физика 
('Сидорова Елена Сергеевна', 3), -- Математика 
('Козлов Андрей Михайлович', 4), -- Биология 
('Смирнова Ольга Викторовна', 5), -- Информатика 
('Васильев Дмитрий Андреевич', 6), -- История 
('Новикова Ирина Петровна', 7), -- География 
('Морозова Екатерина Алексеевна', 8), -- Литература 
('Соколов Артем Игоревич', 2), -- Физика 
('Лебедева Анастасия Сергеевна', 3), -- Математика 
('Волков Максим Дмитриевич', 4), -- Биология 
('Белова Светлана Юрьевна', 5), -- Информатика 
('Зайцев Роман Владимирович', 6), -- История 
('Павлова Ксения Олеговна', 7), -- География 
('Ершов Никита Андреевич', 8), -- Литература 
('Коновалова Дарья Ивановна', 1), -- Химия 
('Рыбаков Алексей Петрович', 1), -- Химия 
('Попова Мария Владимировна', 2), -- Физика 
('Кузьмин Игорь Дмитриевич', 2); -- Физика 
 
-- Вставка данных в таблицу Выдача книги 
INSERT INTO book_issue (fk_reader, number, fid_book, issue_date, return_date) VALUES 
(1, 1, 1, '2024-05-20', '2024-06-03'), -- Кузнецова, Один день Ивана Денисовича 
(1, 2, 2, '2024-06-12', '2024-06-26'), -- Кузнецова, Война и Мир 
(2, 1, 1, '2024-07-01', NULL), -- Иванов, Один день Ивана Денисовича 
(3, 1, 3, '2024-05-25', '2024-06-10'), -- Петров, Преступление и наказание 
(4, 1, 4, '2024-06-01', '2024-06-15'), -- Сидорова, Мастер и Маргарита 
(5, 1, 5, '2024-07-10', NULL), -- Козлов, Евгений Онегин 
(6, 1, 6, '2024-06-15', '2024-07-01'), -- Смирнова, Герой нашего времени 
(7, 1, 7, '2024-07-05', NULL), -- Васильев, Мертвые души 
(8, 1, 8, '2024-06-20', '2024-07-10'), -- Новикова, Вишневый сад 
(9, 1, 9, '2024-07-15', NULL), -- Морозова, Азазель 
(10, 1, 10, '2024-05-10', '2024-05-25'), -- Соколов, Чапаев и Пустота 
(11, 1, 11, '2024-06-28', '2024-07-10'), -- Лебедева, Сердце Пармы 
(12, 1, 12, '2024-07-20', NULL), -- Волков, Петровы в гриппе и вокруг него 
(13, 1, 13, '2024-05-05', '2024-05-20'), -- Белова, Текст 
(14, 1, 1, '2024-06-01', '2024-06-15'), -- Зайцев, Один день Ивана Денисовича 
(15, 1, 2, '2024-07-01', NULL), -- Павлова, Война и Мир 
(16, 1, 3, '2024-06-10', '2024-06-25'); -- Ершов 
 
-- Проверка данных в таблице Направление 
SELECT * FROM direction; 
 
-- Проверка данных в таблице Автор 
SELECT * FROM author; 
 
-- Проверка данных в таблице Название книги 
SELECT * FROM book_title; 
 
-- Проверка данных в таблице Читатель 
SELECT * FROM reader; 
 
-- Проверка данных в таблице Выдача книги 
SELECT * FROM book_issue; 
 
-- Отчет 1: Список всех книг с их авторами 
SELECT bt.title, a.name AS author_name 
FROM book_title bt 
JOIN author a ON bt.fk_author = a.id_author; 
-- Этот отчет показывает все книги и их авторов. 
 
-- Отчет 2: Список читателей и книг, которые они взяли 
SELECT r.full_name AS reader_name, bt.title, bi.issue_date, bi.return_date 
FROM book_issue bi 
JOIN reader r ON bi.fk_reader = r.id_reader 
JOIN book_title bt ON bi.fid_book = bt.id_book_title; 
-- Этот отчет показывает читателей и книги, которые они взяли с датами выдачи и возврата. 
 
-- Отчет 3: Количество книг, выданных каждым читателем 
SELECT r.full_name AS reader_name, COUNT(bi.fid_book) AS books_issued 
FROM book_issue bi 
JOIN reader r ON bi.fk_reader = r.id_reader 
GROUP BY r.full_name; 
-- Этот отчет показывает количество книг, выданных каждому читателю.